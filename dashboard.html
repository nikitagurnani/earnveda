<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EarnVeda Pro</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f4f7f6; margin: 0; padding-bottom: 70px; text-align: center; }
        .header { background: #1a73e8; color: white; padding: 20px; font-size: 22px; font-weight: bold; }
        .tab-content { display: none; padding: 20px; }
        .active { display: block; }
        .card { background: white; margin-bottom: 20px; padding: 30px; border-radius: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .balance-amount { font-size: 48px; color: #28a745; font-weight: bold; }
        .btn-main { background: #1a73e8; color: white; border: none; padding: 18px; border-radius: 12px; width: 100%; font-size: 18px; font-weight: bold; cursor: pointer; }
        .nav-bar { position: fixed; bottom: 0; width: 100%; background: white; display: flex; border-top: 1px solid #ddd; }
        .nav-item { cursor: pointer; padding: 12px 0; flex: 1; font-size: 14px; }
        .active-nav { color: #1a73e8; font-weight: bold; }
        .history-item { border-bottom: 1px solid #eee; padding: 10px; text-align: left; font-size: 14px; }
        .history-date { color: #888; font-size: 12px; }
        .history-amount { color: #28a745; font-weight: bold; float: right; }
    </style>
</head>
<body>
    <div class="header" id="pageTitle">EarnVeda</div>

    <div id="homeTab" class="tab-content active">
        <div class="card">
            <p>Wallet Balance</p>
            <div class="balance-amount">‚Çπ<span id="bal">0.00</span></div>
        </div>
        <div class="card">
            <h3>Daily Tasks</h3>
            <button class="btn-main" onclick="handleAd()">üì∫ Watch Ad & Earn ‚Çπ0.15</button>
        </div>
    </div>

    <div id="transTab" class="tab-content">
        <div class="card">
            <h3>Earning History</h3>
            <div id="historyList">Loading history...</div>
        </div>
    </div>

    <div id="profileTab" class="tab-content">
        <div id="adminArea"></div>
        <div class="card">
            <h3>Withdraw Money</h3>
            <input type="text" id="upi" placeholder="Enter UPI ID" style="width:90%; padding:10px; margin-bottom:10px; border:1px solid #ccc; border-radius:8px;">
            <button class="btn-main" onclick="alert('Minimum ‚Çπ100 required for withdrawal')">Withdraw</button>
        </div>
        <button onclick="logout()" style="color:red; background:none; border:none; margin-top:20px; cursor:pointer; font-weight:bold;">Logout Account</button>
    </div>

    <div class="nav-bar">
        <div class="nav-item active-nav" onclick="switchTab('homeTab', 'EarnVeda', this)">üè† Home</div>
        <div class="nav-item" onclick="switchTab('transTab', 'History', this)">üìä History</div>
        <div class="nav-item" onclick="switchTab('profileTab', 'Profile', this)">üë§ Profile</div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCLrqzCQq_i7EzWdw_aoGRvIHzgcAQFuvI",
            authDomain: "earnify-official.firebaseapp.com",
            databaseURL: "https://earnify-official-default-rtdb.firebaseio.com",
            projectId: "earnify-official",
            storageBucket: "earnify-official.firebasestorage.app",
            messagingSenderId: "392652401236",
            appId: "1:392652401236:web:00bd6e145cb6ac1f6c9bc1"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const userPhone = localStorage.getItem('userPhone');

        if (!userPhone) {
            window.location.href = "index.html";
        }

        // Live Balance & History Display
        db.ref('users/' + userPhone).on('value', (s) => {
            if(s.exists()){
                const userData = s.val();
                document.getElementById('bal').innerText = userData.balance || "0.00";
                
                // History Load Karo
                let historyHTML = "";
                if(userData.history){
                    Object.values(userData.history).reverse().forEach(item => {
                        historyHTML += `
                            <div class="history-item">
                                <span>Ad Reward</span>
                                <span class="history-amount">+‚Çπ${item.amount}</span><br>
                                <span class="history-date">${item.date}</span>
                            </div>
                        `;
                    });
                } else {
                    historyHTML = "No history yet.";
                }
                document.getElementById('historyList').innerHTML = historyHTML;
            }
        });

        if (userPhone === "7067007802") {
            document.getElementById('adminArea').innerHTML = `
                <button onclick="window.location.href='admin.html'" style="background:gold; padding:15px; width:100%; border-radius:12px; margin-bottom:15px; font-weight:bold; border:none; cursor:pointer;">‚≠ê OPEN ADMIN PANEL</button>
            `;
        }

        function switchTab(id, title, el) {
            document.querySelectorAll('.tab-content').forEach(x => x.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(x => x.classList.remove('active-nav'));
            document.getElementById(id).classList.add('active');
            document.getElementById('pageTitle').innerText = title;
            el.classList.add('active-nav');
        }

        function handleAd() {
            window.open("https://www.effectivegatecpm.com/bifuu5v6ex?key=0ee07ca35e1ad46941096148394ad311", "_blank");
            
            const userRef = db.ref('users/' + userPhone);
            userRef.once('value').then((snapshot) => {
                let currentBal = 0;
                if(snapshot.exists() && snapshot.val().balance) {
                    currentBal = parseFloat(snapshot.val().balance);
                }
                
                let reward = 0.15;
                let newBal = (currentBal + reward).toFixed(2); 
                let timestamp = new Date().toLocaleString();

                // Update Balance AND Add History Entry
                userRef.update({
                    balance: newBal
                });
                
                // Alag se history table mein entry
                userRef.child('history').push({
                    amount: reward.toFixed(2),
                    date: timestamp
                }).then(() => {
                    console.log("History & Balance Updated");
                });
            });
        }

        function logout() {
            localStorage.clear();
            window.location.href = "index.html";
        }
    </script>
</body>
</html>
