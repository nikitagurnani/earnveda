<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EarnVeda - Login</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f4f7f6; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
        .login-card { background: white; padding: 40px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); width: 320px; text-align: center; }
        h2 { color: #1a73e8; margin-bottom: 25px; }
        input { width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid #ddd; border-radius: 10px; box-sizing: border-box; }
        .btn-login { background: #1a73e8; color: white; border: none; padding: 15px; border-radius: 10px; width: 100%; font-size: 16px; font-weight: bold; cursor: pointer; }
        .footer-text { margin-top: 20px; font-size: 12px; color: #777; }
    </style>
</head>
<body>

    <div class="login-card">
        <h2>EarnVeda Login</h2>
        <input type="number" id="phone" placeholder="Phone Number">
        <input type="password" id="password" placeholder="Password">
        <button class="btn-login" id="loginBtn" onclick="handleLogin()">Login / Register</button>
        <p class="footer-text">Naya number hai toh apne aap Register ho jayega.</p>
    </div>

    <script>
        // FIREBASE CONFIG (Wahi jo dashboard mein hai)
        const firebaseConfig = {
            apiKey: "AIzaSyCLrqzCQq_i7EzWdw_aoGRvIHzgcAQFuvI",
            authDomain: "earnify-official.firebaseapp.com",
            databaseURL: "https://earnify-official-default-rtdb.firebaseio.com",
            projectId: "earnify-official",
            storageBucket: "earnify-official.firebasestorage.app",
            messagingSenderId: "392652401236",
            appId: "1:392652401236:web:00bd6e145cb6ac1f6c9bc1"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        function handleLogin() {
            const phone = document.getElementById('phone').value.trim();
            const pass = document.getElementById('password').value.trim();
            const btn = document.getElementById('loginBtn');

            if (phone.length < 10 || pass === "") {
                alert("Sahi Number aur Password dalein!");
                return;
            }

            btn.innerText = "Checking...";
            btn.disabled = true;

            const userRef = db.ref('users/' + phone);

            userRef.once('value').then((snapshot) => {
                if (snapshot.exists()) {
                    // Agar user pehle se hai, toh password match karo
                    if (snapshot.val().password === pass) {
                        localStorage.setItem('userPhone', phone);
                        window.location.href = "dashboard.html";
                    } else {
                        alert("Galat Password!");
                        btn.innerText = "Login / Register";
                        btn.disabled = false;
                    }
                } else {
                    // Agar naya user hai (Jaise 8827...), toh uska account banao
                    userRef.set({
                        phone: phone,
                        password: pass,
                        balance: "0.00"
                    }).then(() => {
                        alert("Account Created Successfully!");
                        localStorage.setItem('userPhone', phone);
                        window.location.href = "dashboard.html";
                    });
                }
            }).catch((err) => {
                alert("Error: " + err.message);
                btn.innerText = "Login / Register";
                btn.disabled = false;
            });
        }
    </script>
</body>
</html>
