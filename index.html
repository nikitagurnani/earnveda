<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EarnVeda - Secure Login</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f0f2f5; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
        .auth-container { background: white; padding: 25px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); width: 90%; max-width: 400px; text-align: center; }
        h2 { color: #1abc9c; margin-bottom: 5px; }
        p.subtitle { color: #7f8c8d; font-size: 14px; margin-bottom: 20px; }
        input { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #ddd; border-radius: 10px; box-sizing: border-box; font-size: 16px; }
        .rules { text-align: left; font-size: 11px; color: #e67e22; margin: 5px 0 15px 5px; line-height: 1.4; }
        button { width: 100%; padding: 14px; background: #1abc9c; color: white; border: none; border-radius: 10px; font-size: 16px; font-weight: bold; cursor: pointer; transition: 0.3s; }
        button:hover { background: #16a085; }
        .footer-warn { color: #e74c3c; font-size: 12px; margin-top: 15px; font-weight: bold; border-top: 1px solid #eee; padding-top: 10px; }
    </style>
</head>
<body>

<div class="auth-container">
    <h2>EarnVeda üí∞</h2>
    <p class="subtitle">Apna secure account banayein</p>
    
    <input type="number" id="phone" placeholder="Mobile Number">
    
    <div class="rules">
        * Min 8 characters<br>
        * Must include: ABC, abc, 123, & @#$
    </div>
    
    <input type="password" id="pass1" placeholder="Create Strong Password">
    <input type="password" id="pass2" placeholder="Confirm Password">
    
    <button onclick="validateAndProcess()">Login / Register</button>
    
    <div class="footer-warn">
        ‚ö†Ô∏è Password bhulne par balance lost ho jayega.<br>Reset option available nahi hai!
    </div>
</div>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

<script>
    const firebaseConfig = { apiKey: "AIzaSyCLrqzC0q_i7EzWdw_aoGRvI-qD_2kMsc", projectId: "earnify-official" };
    if (!firebase.apps.length) { firebase.initializeApp(firebaseConfig); }
    const db = firebase.firestore();

    function validateAndProcess() {
        const phone = document.getElementById('phone').value;
        const p1 = document.getElementById('pass1').value;
        const p2 = document.getElementById('pass2').value;

        if(phone.length < 10) { alert("Kripya sahi mobile number dalein!"); return; }
        
        const strongRegex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#\$%\^&\*])(?=.{8,})/;
        
        if(!strongRegex.test(p1)) {
            alert("Password kamzor hai! ABC, abc, 123 aur special symbol use karein.");
            return;
        }

        if(p1 !== p2) {
            alert("Dono password match nahi kar rahe!");
            return;
        }

        db.collection("users").doc(phone).get().then((doc) => {
            if(doc.exists) {
                if(doc.data().password === p1) {
                    localStorage.setItem("userPhone", phone);
                    // Yahan humne folder ka rasta badal diya hai
                    window.location.href = "earnveda/dashboard.html";
                } else {
                    alert("Galat Password!");
                }
            } else {
                const confirmReg = confirm("Account banane se pehle iska SCREENSHOT le lein!");
                if(confirmReg) {
                    db.collection("users").doc(phone).set({
                        balance: 0,
                        password: p1,
                        notification: "Welcome to EarnVeda!",
                        regDate: new Date().toISOString()
                    }).then(() => {
                        localStorage.setItem("userPhone", phone);
                        // Yahan bhi badlav kar diya hai
                        window.location.href = "earnveda/dashboard.html";
                    });
                }
            }
        });
    }
</script>

</body>
</html>
