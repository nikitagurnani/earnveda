<!DOCTYPE html>
<html>
<head>
  <title>EarnVeda Master Admin</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body {margin:0;font-family:Arial;background:#f4f6f9;}
    .topbar {background:#111;color:white;padding:15px;font-size:20px; display: flex; justify-content: space-between;}
    .container {padding:20px;}
    .cards {display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:15px;}
    .card {
      background:white;
      padding:15px;
      border-radius:10px;
      box-shadow:0 2px 8px rgba(0,0,0,0.1);
      text-align: center;
    }
    .card b { font-size: 22px; color: #3b82f6; }
    table { width:100%; background:white; border-collapse:collapse; margin-top:20px; }
    th, td { padding:12px; border:1px solid #ddd; text-align:center; }
    button { padding:8px 15px; border:none; border-radius:5px; cursor:pointer; font-weight:bold; }
    .approve {background:green;color:white;}
    .reject {background:red;color:white;}
    .login-box { width:300px; margin:100px auto; background:white; padding:20px; border-radius:10px; box-shadow:0 2px 10px rgba(0,0,0,0.2); text-align:center; }
    input {width:90%;padding:10px;margin:10px 0; border: 1px solid #ccc; border-radius: 5px;}
  </style>
</head>
<body>

<div id="loginPage">
  <div class="login-box">
    <h2>Admin Login</h2>
    <input type="password" id="adminPass" placeholder="Enter Admin Password">
    <button onclick="login()" style="background: #111; color: white; width: 100%;">Login</button>
  </div>
</div>

<div id="adminPanel" style="display:none;">
  <div class="topbar">
    <span>EarnVeda Master Panel</span>
    <small id="syncStatus" style="font-size: 12px; color: #22c55e;">Connected ●</small>
  </div>
  <div class="container">

    <div class="cards">
      <div class="card">Total Users: <br><b id="totalUsers">0</b></div>
      <div class="card">Total Revenue: <br>₹<b id="totalRevenue">0</b></div>
      <div class="card">Admin (70%): <br>₹<b id="adminShare">0</b></div>
      <div class="card">Users (30%): <br>₹<b id="userShare">0</b></div>
    </div>

    <div style="margin-top: 30px; background: white; padding: 15px; border-radius: 10px;">
        <h3>Quick Update User Balance</h3>
        <input type="number" id="userPhone" placeholder="Phone Number" style="width: 40%;">
        <input type="number" id="newAmount" placeholder="Amount" style="width: 40%;">
        <button class="approve" onclick="manualUpdate()">Update</button>
    </div>

    <h3>Withdrawal Requests</h3>
    <table>
      <thead>
        <tr>
          <th>User</th>
          <th>Amount</th>
          <th>Status</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody id="withdrawTable">
        <tr><td colspan="4">No pending requests</td></tr>
      </tbody>
    </table>

  </div>
</div>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

<script>
// Firebase Config
const firebaseConfig = { 
    apiKey: "AIzaSyCLrqzC0q_i7EzWdw_aoGRvI-qD_2kMsc", 
    projectId: "earnify-official" 
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

let adminPassword = "786"; 

function login(){
  let pass = document.getElementById("adminPass").value;
  if(pass === adminPassword){
    document.getElementById("loginPage").style.display="none";
    document.getElementById("adminPanel").style.display="block";
    syncData();
  } else {
    alert("Wrong Password");
  }
}

// Database se Real-time data laane ke liye
function syncData(){
  // 1. Total Users Count
  db.collection("users").onSnapshot(snap => {
    document.getElementById("totalUsers").innerText = snap.size;
    
    let totalBal = 0;
    snap.forEach(doc => {
        totalBal += (doc.data().balance || 0);
    });
    
    // Revenue logic (Demo logic based on your 70/30)
    let rev = totalBal * 1.5; // Example math
    document.getElementById("totalRevenue").innerText = rev.toFixed(2);
    document.getElementById("adminShare").innerText = (rev * 0.7).toFixed(2);
    document.getElementById("userShare").innerText = (rev * 0.3).toFixed(2);
  });

  // 2. Withdrawal Requests
  db.collection("withdrawals").where("status", "==", "Pending")
    .onSnapshot(snap => {
      let table = document.getElementById("withdrawTable");
      table.innerHTML = "";
      if(snap.empty) table.innerHTML = "<tr><td colspan='4'>No pending requests</td></tr>";
      
      snap.forEach(doc => {
        let data = doc.data();
        table.innerHTML += `
          <tr>
            <td>${doc.id}</td>
            <td>₹${data.amount}</td>
            <td>${data.status}</td>
            <td>
              <button class="approve" onclick="updateStatus('${doc.id}', 'Approved')">Approve</button>
              <button class="reject" onclick="updateStatus('${doc.id}', 'Rejected')">Reject</button>
            </td>
          </tr>
        `;
      });
    });
}

// Balance update karne ka function
async function manualUpdate() {
    let ph = document.getElementById("userPhone").value;
    let amt = parseFloat(document.getElementById("newAmount").value);
    if(!ph || isNaN(amt)) return alert("Data sahi bharo");

    try {
        await db.collection("users").doc(ph).set({ balance: amt }, { merge: true });
        alert("Success! Balance updated.");
    } catch(e) { alert("Error: " + e.message); }
}

// Withdrawal Approve/Reject karne ke liye
async function updateStatus(id, newStatus) {
    try {
        await db.collection("withdrawals").doc(id).update({ status: newStatus });
        alert("Request " + newStatus);
    } catch(e) { alert("Error: " + e.message); }
}

</script>
</body>
</html>
